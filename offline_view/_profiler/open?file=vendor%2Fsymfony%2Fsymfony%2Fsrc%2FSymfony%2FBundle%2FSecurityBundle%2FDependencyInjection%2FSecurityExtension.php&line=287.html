<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="robots" content="noindex,nofollow" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Symfony Profiler</title>
        <link rel="icon" type="image/x-icon" sizes="16x16" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAFEUlEQVR4AZVXA4wm2RMf27bXDM/+3/+sYBGfrbVtezc6BWtzfPbYXtvDL9906t6v0vWl05me7q1JzXuvvu4yXnvZgJ9hH6bwZYXLFR739vauUGuDwhq1L1N4Uv/tRYUhFjwcg49hn6aYr1V4TiGp86CoP9Oh1tV414KnM6t9fHymKUZ3DAI0hW4b1AyK3lE8phh5OxWeoJgUGhi5mLm95YzBwcHuhIQEV1JSEoWGhoKWHxYWFmenhJ/B5W0GwZpDt5Ovry9lZWWRyWOu5ORk7JsUpogsq5gnmISTU+HKQoLFQv/qq6/os88+I+EVFRUlSsRZ5oRiVmwlXMWShQkahUdERJCfnx/vd+3aRTU1NXTixAmqrq6mK1eu0PTp05mnrmD+QK6XhLO0XP2O2FJAQICRjjMU4P1PP/1EfX19NGfOHM8Z0N7ezueQkBBXYGAgSWIaQ5Em2T5QzFNSUig9PV3OHOe4uDjZ87p//34C7Nm7x/NcRUUFAX799Vec8Y7m7+8Pz92SfBDXr7VwPYRbxn/MmDG8Tps2jQBd3V30/PPPe35/6qmnaPXq1TR69Gg+h4eHiwwosdLT4dBkQDSXWmJiIq/vv/8+/fvvv3ThwgWqr6+n/Px8oyCmAerq6jy03Nxc2Yv7ySSjQzrmi4i92fVpaWlYOZ79/f2MW7dtpSlTptDp06epo6ODPvroI850ASiGdyZOnEjXrl2jyspKT4XA9cgjkaPL/D8UWG62HokieyQQoKSkRGiMs2bNotraWmprayOBNWvWyO+scGdnp5zF/WYvLEb8TwpRykp1MV7feust6uzqJMD169fpueeeY/rDDz/MKzzgdrsJoGkaffvtt/TFF19wQsIDmzZtssojt+6Fo1CgzKiAvAB3DRs2jAULtLS0eErPGB5Ad3c3lZaWUnFxMfeAd955h5+JjY3FaqXAPwhBnRCNySK4b98+Aoilv/z6i/zGggSk1g0opWupAMvGP91yt96zadWqVdTc3Ezz58/31LOAy+US6zgHBP766y+mDR8+HBUgFWSnQI2EAFnqlpcaGxsJIFkMN8L9AnPnzmX6jRs3SACeAi0vL888JwYPgTEJpauhnADo6/LSgQMHCHD37l2Cp15//XXq7eslgKb+Fi1exM9lZmbaCDclIcpQQhATE4OVsrOzuamg+cyePZuzG64Hrlu3jp9ZuWolCdy+fZueeOIJpkdHR1sLHqgM0Yh0bTRz1m7fvp2KiopYkYKCApo8ebLZIwzlFeXSOXEnsLPe2Ij+p5DbYYdOdOtDQ0rNjFya5sTcsGGDcTDZoXTcNoVBMoxWyzDS2yXmOyeUtGSskmDjx4/nRgPAfBDmMpZtUIbRcsi2GsfSD2QYyd2OcdmyZSSwdu1apuXk5GB16v4bak0yX0imyIUEgwNovFTglhMZGcm0srIy43zAVUxuTLbW4xn17Fci23wly9dngUummrTaixcvMpOtW7fiiBwQpqKYU9efHuxDJE5hC9wvL9TW1RLg+PHjPGTQ8wsLC4WpDC5Y5UR4k5qKMSLT6lqeAiX0nuAaMmSI9sMPP9CZM2foyJEj9O677wpTVIuTjidNp0HibvttoH9E5OMqbWKkSaNSlojldoLF7TEP+nUEmKI62y1kOBINbVaNarcI0PuGGUlHyfYvLHg7/jhFSFYqZh0P8KHSptd5ksOPU3tvqAEUot/hFmOIYJLp87wGe9Dwm95eg5xa/R8G6d8U5EcFhwAAAABJRU5ErkJggg==">

            <style>
        
html{font-family:sans-serif;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{margin:.67em 0;font-size:2em}mark{color:#000;background:#ff0}small{font-size:80%}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{height:0;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{padding:.35em .625em .75em;margin:0 2px;border:1px solid silver}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}

html, body  {
    height: 100%;
    width: 100%;
}
body {
    background-color: #F9F9F9;
    color: #aaa;
    display: flex;
    flex-direction: column;
    font-family: Helvetica, Arial, sans-serif;
    font-size: 14px;
    line-height: 1.4;
}
.header {
    background-color: #222;
    position: fixed;
    top: 0;
    display: flex;
    width: 100%;
}
.header h1 {
    color: #FFF;
    font-weight: normal;
    font-size: 21px;
    margin: 0;
    padding: 10px 10px 8px;
    word-break: break-all;
}

a.doc {
    color: #FFF;
    text-decoration: none;
    margin: auto;
    margin-right: 10px;
}

a.doc:hover {
    text-decoration: underline;
}

.source {
    margin-top: 41px;
}

.source li code {
    color: #555;
}

.source li.selected {
    background: rgba(255, 255, 153, 0.5);
}

.anchor {
    position: relative;
    display: inline-block;
    top: -7em;
    visibility: hidden;
}

    </style>
    </head>
    <body>
        <div class="header">
    <h1>vendor/symfony/symfony/src/Symfony/Bundle/SecurityBundle/DependencyInjection/SecurityExtension.php <small>line 287</small></h1>
    <a class="doc" href="https://symfony.com/doc/3.4.15/reference/configuration/framework.html#ide" rel="help">Open in your IDE?</a>
</div>
<div class="source">
    <ol start="1"><li><a class="anchor" name="line1"></a><code><span style="color: #0000BB">&lt;?php</span></span></code></li>
<li><a class="anchor" name="line2"></a><code><span style="color: #0000BB"></span></span></code></li>
<li><a class="anchor" name="line3"></a><code><span style="color: #0000BB"></span><span style="color: #FF8000">/*</span></span></code></li>
<li><a class="anchor" name="line4"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;Symfony&nbsp;package.</span></span></code></li>
<li><a class="anchor" name="line5"></a><code><span style="color: #FF8000">&nbsp;*</span></span></code></li>
<li><a class="anchor" name="line6"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;(c)&nbsp;Fabien&nbsp;Potencier&nbsp;&lt;fabien@symfony.com&gt;</span></span></code></li>
<li><a class="anchor" name="line7"></a><code><span style="color: #FF8000">&nbsp;*</span></span></code></li>
<li><a class="anchor" name="line8"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;For&nbsp;the&nbsp;full&nbsp;copyright&nbsp;and&nbsp;license&nbsp;information,&nbsp;please&nbsp;view&nbsp;the&nbsp;LICENSE</span></span></code></li>
<li><a class="anchor" name="line9"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;file&nbsp;that&nbsp;was&nbsp;distributed&nbsp;with&nbsp;this&nbsp;source&nbsp;code.</span></span></code></li>
<li><a class="anchor" name="line10"></a><code><span style="color: #FF8000">&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line11"></a><code><span style="color: #FF8000"></span></span></code></li>
<li><a class="anchor" name="line12"></a><code><span style="color: #FF8000"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Bundle</span><span style="color: #007700">\</span><span style="color: #0000BB">SecurityBundle</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line13"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line14"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Bundle</span><span style="color: #007700">\</span><span style="color: #0000BB">SecurityBundle</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Factory</span><span style="color: #007700">\</span><span style="color: #0000BB">SecurityFactoryInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line15"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Bundle</span><span style="color: #007700">\</span><span style="color: #0000BB">SecurityBundle</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">UserProvider</span><span style="color: #007700">\</span><span style="color: #0000BB">UserProviderFactoryInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line16"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Config</span><span style="color: #007700">\</span><span style="color: #0000BB">Definition</span><span style="color: #007700">\</span><span style="color: #0000BB">Exception</span><span style="color: #007700">\</span><span style="color: #0000BB">InvalidConfigurationException</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line17"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Config</span><span style="color: #007700">\</span><span style="color: #0000BB">FileLocator</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line18"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Console</span><span style="color: #007700">\</span><span style="color: #0000BB">Application</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line19"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Alias</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line20"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Argument</span><span style="color: #007700">\</span><span style="color: #0000BB">IteratorArgument</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line21"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line22"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Compiler</span><span style="color: #007700">\</span><span style="color: #0000BB">ServiceLocatorTagPass</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line23"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">ContainerBuilder</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line24"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Loader</span><span style="color: #007700">\</span><span style="color: #0000BB">XmlFileLoader</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line25"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Parameter</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line26"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Reference</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line27"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">HttpKernel</span><span style="color: #007700">\</span><span style="color: #0000BB">DependencyInjection</span><span style="color: #007700">\</span><span style="color: #0000BB">Extension</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line28"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Core</span><span style="color: #007700">\</span><span style="color: #0000BB">Authorization</span><span style="color: #007700">\</span><span style="color: #0000BB">ExpressionLanguage</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line29"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Core</span><span style="color: #007700">\</span><span style="color: #0000BB">Authorization</span><span style="color: #007700">\</span><span style="color: #0000BB">Voter</span><span style="color: #007700">\</span><span style="color: #0000BB">VoterInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line30"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Core</span><span style="color: #007700">\</span><span style="color: #0000BB">Encoder</span><span style="color: #007700">\</span><span style="color: #0000BB">Argon2iPasswordEncoder</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line31"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line32"></a><code><span style="color: #007700"></span><span style="color: #FF8000">/**</span></span></code></li>
<li><a class="anchor" name="line33"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;SecurityExtension.</span></span></code></li>
<li><a class="anchor" name="line34"></a><code><span style="color: #FF8000">&nbsp;*</span></span></code></li>
<li><a class="anchor" name="line35"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;@author&nbsp;Fabien&nbsp;Potencier&nbsp;&lt;fabien@symfony.com&gt;</span></span></code></li>
<li><a class="anchor" name="line36"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;@author&nbsp;Johannes&nbsp;M.&nbsp;Schmitt&nbsp;&lt;schmittjoh@gmail.com&gt;</span></span></code></li>
<li><a class="anchor" name="line37"></a><code><span style="color: #FF8000">&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line38"></a><code><span style="color: #FF8000"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">SecurityExtension&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">Extension</span></span></code></li>
<li><a class="anchor" name="line39"></a><code><span style="color: #0000BB"></span><span style="color: #007700">{</span></span></code></li>
<li><a class="anchor" name="line40"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$requestMatchers&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line41"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$expressions&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line42"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$contextListeners&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line43"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$listenerPositions&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'pre_auth'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'form'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'http'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'remember_me'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line44"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$factories&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line45"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$userProviderFactories&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line46"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$expressionLanguage</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line47"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$logoutOnUserChangeByContextKey&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line48"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$statelessFirewallKeys&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line49"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line50"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()</span></span></code></li>
<li><a class="anchor" name="line51"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line52"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">listenerPositions&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$position</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line53"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">factories</span><span style="color: #007700">[</span><span style="color: #0000BB">$position</span><span style="color: #007700">]&nbsp;=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line54"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line55"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line56"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line57"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">load</span><span style="color: #007700">(array&nbsp;</span><span style="color: #0000BB">$configs</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line58"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line59"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">array_filter</span><span style="color: #007700">(</span><span style="color: #0000BB">$configs</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line60"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line61"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line62"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line63"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mainConfig&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getConfiguration</span><span style="color: #007700">(</span><span style="color: #0000BB">$configs</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line64"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line65"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">processConfiguration</span><span style="color: #007700">(</span><span style="color: #0000BB">$mainConfig</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$configs</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line66"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line67"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;load&nbsp;services</span></span></code></li>
<li><a class="anchor" name="line68"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">XmlFileLoader</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">FileLocator</span><span style="color: #007700">(</span><span style="color: #0000BB">__DIR__</span><span style="color: #007700">.</span><span style="color: #DD0000">'/../Resources/config'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line69"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line70"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'security_listeners.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line71"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'security_rememberme.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line72"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'templating_php.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line73"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'templating_twig.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line74"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'collectors.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line75"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'guard.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line76"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line77"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.guard_handler'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line78"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.firewall'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line79"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.firewall.context'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line80"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.validator.user_password'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line81"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.rememberme.response_listener'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line82"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'templating.helper.logout_url'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line83"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'templating.helper.security'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line84"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.encoder_factory'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line85"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line86"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'kernel.debug'</span><span style="color: #007700">)&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'kernel.debug'</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line87"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'security_debug.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line88"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line89"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.firewall'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line90"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line91"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line92"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">class_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'Symfony\Component\ExpressionLanguage\ExpressionLanguage'</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line93"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">removeDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.expression_language'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line94"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">removeDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access.expression_voter'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line95"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line96"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line97"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;set&nbsp;some&nbsp;global&nbsp;scalars</span></span></code></li>
<li><a class="anchor" name="line98"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access.denied_url'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_url'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line99"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.manager.erase_credentials'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'erase_credentials'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line100"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.session_strategy.strategy'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'session_fixation_strategy'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line101"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line102"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_decision_manager'</span><span style="color: #007700">][</span><span style="color: #DD0000">'service'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line103"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access.decision_manager'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_decision_manager'</span><span style="color: #007700">][</span><span style="color: #DD0000">'service'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line104"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line105"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line106"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access.decision_manager'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line107"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_decision_manager'</span><span style="color: #007700">][</span><span style="color: #DD0000">'strategy'</span><span style="color: #007700">])</span></span></code></li>
<li><a class="anchor" name="line108"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_decision_manager'</span><span style="color: #007700">][</span><span style="color: #DD0000">'allow_if_all_abstain'</span><span style="color: #007700">])</span></span></code></li>
<li><a class="anchor" name="line109"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_decision_manager'</span><span style="color: #007700">][</span><span style="color: #DD0000">'allow_if_equal_granted_denied'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line110"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line111"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line112"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access.always_authenticate_before_granting'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'always_authenticate_before_granting'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line113"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.hide_user_not_found'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'hide_user_not_found'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line114"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line115"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createFirewalls</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line116"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createAuthorization</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line117"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createRoleHierarchy</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line118"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line119"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.guard_handler'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line120"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">statelessFirewallKeys</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line121"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line122"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'encoders'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line123"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createEncoders</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'encoders'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line124"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line125"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line126"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">class_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">Application</span><span style="color: #007700">::class))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line127"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'console.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line128"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.command.user_password_encoder'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">array_keys</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'encoders'</span><span style="color: #007700">]));</span></span></code></li>
<li><a class="anchor" name="line129"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line130"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line131"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;load&nbsp;ACL</span></span></code></li>
<li><a class="anchor" name="line132"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'acl'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line133"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">aclLoad</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'acl'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line134"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line135"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">removeDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.command.init_acl'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line136"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">removeDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.command.set_acl'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line137"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line138"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line139"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">registerForAutoconfiguration</span><span style="color: #007700">(</span><span style="color: #0000BB">VoterInterface</span><span style="color: #007700">::class)</span></span></code></li>
<li><a class="anchor" name="line140"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addTag</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.voter'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line141"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line142"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(\</span><span style="color: #0000BB">PHP_VERSION_ID&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">70000</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line143"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;some&nbsp;required&nbsp;classes&nbsp;for&nbsp;compilation</span></span></code></li>
<li><a class="anchor" name="line144"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addClassesToCompile</span><span style="color: #007700">(array(</span></span></code></li>
<li><a class="anchor" name="line145"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Http\Firewall'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line146"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\User\UserProviderInterface'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line147"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Authentication\AuthenticationProviderManager'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line148"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Authentication\Token\Storage\TokenStorage'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line149"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Authorization\AccessDecisionManager'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line150"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Authorization\AuthorizationChecker'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line151"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Authorization\Voter\VoterInterface'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line152"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Bundle\SecurityBundle\Security\FirewallConfig'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line153"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Bundle\SecurityBundle\Security\FirewallContext'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line154"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\HttpFoundation\RequestMatcher'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line155"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));</span></span></code></li>
<li><a class="anchor" name="line156"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line157"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line158"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line159"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">aclLoad</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line160"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line161"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">interface_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'Symfony\Component\Security\Acl\Model\AclInterface'</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line162"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span style="color: #0000BB">LogicException</span><span style="color: #007700">(</span><span style="color: #DD0000">'You&nbsp;must&nbsp;install&nbsp;symfony/security-acl&nbsp;in&nbsp;order&nbsp;to&nbsp;use&nbsp;the&nbsp;ACL&nbsp;functionality.'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line163"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line164"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line165"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">XmlFileLoader</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">FileLocator</span><span style="color: #007700">(</span><span style="color: #0000BB">__DIR__</span><span style="color: #007700">.</span><span style="color: #DD0000">'/../Resources/config'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line166"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'security_acl.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line167"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line168"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'cache'</span><span style="color: #007700">][</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line169"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.cache'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'cache'</span><span style="color: #007700">][</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line170"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line171"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.voter.basic_permissions'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'voter'</span><span style="color: #007700">][</span><span style="color: #DD0000">'allow_if_object_identity_unavailable'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line172"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line173"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;custom&nbsp;ACL&nbsp;provider</span></span></code></li>
<li><a class="anchor" name="line174"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line175"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.provider'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line176"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line177"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line178"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line179"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line180"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">configureDbalAclProvider</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line181"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line182"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line183"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">configureDbalAclProvider</span><span style="color: #007700">(array&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line184"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line185"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$loader</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'security_acl_dbal.xml'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line186"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line187"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.schema'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line188"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.connection'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line189"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.provider'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line190"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line191"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'connection'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line192"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.connection'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'doctrine.dbal.%s_connection'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'connection'</span><span style="color: #007700">]))-&gt;</span><span style="color: #0000BB">setPrivate</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line193"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line194"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line195"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line196"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.schema_listener'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line197"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addTag</span><span style="color: #007700">(</span><span style="color: #DD0000">'doctrine.event_listener'</span><span style="color: #007700">,&nbsp;array(</span></span></code></li>
<li><a class="anchor" name="line198"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'connection'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'connection'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line199"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'event'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'postGenerateSchema'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line200"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'lazy'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line201"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))</span></span></code></li>
<li><a class="anchor" name="line202"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line203"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line204"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.cache.doctrine'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'cache'</span><span style="color: #007700">][</span><span style="color: #DD0000">'prefix'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line205"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line206"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.class_table_name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'tables'</span><span style="color: #007700">][</span><span style="color: #DD0000">'class'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line207"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.entry_table_name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'tables'</span><span style="color: #007700">][</span><span style="color: #DD0000">'entry'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line208"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.oid_table_name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'tables'</span><span style="color: #007700">][</span><span style="color: #DD0000">'object_identity'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line209"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.oid_ancestors_table_name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'tables'</span><span style="color: #007700">][</span><span style="color: #DD0000">'object_identity_ancestors'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line210"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.acl.dbal.sid_table_name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'tables'</span><span style="color: #007700">][</span><span style="color: #DD0000">'security_identity'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line211"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line212"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line213"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createRoleHierarchy</span><span style="color: #007700">(array&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line214"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line215"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'role_hierarchy'</span><span style="color: #007700">])&nbsp;||&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">===&nbsp;\</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'role_hierarchy'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line216"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">removeDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access.role_hierarchy_voter'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line217"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line218"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line219"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line220"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line221"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setParameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.role_hierarchy.roles'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'role_hierarchy'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line222"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">removeDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access.simple_role_voter'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line223"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line224"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line225"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createAuthorization</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line226"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line227"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_control'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line228"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line229"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line230"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line231"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(\</span><span style="color: #0000BB">PHP_VERSION_ID&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">70000</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line232"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addClassesToCompile</span><span style="color: #007700">(array(</span></span></code></li>
<li><a class="anchor" name="line233"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'Symfony\\Component\\Security\\Http\\AccessMap'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line234"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));</span></span></code></li>
<li><a class="anchor" name="line235"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line236"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line237"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_control'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line238"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$matcher&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createRequestMatcher</span><span style="color: #007700">(</span></span></code></li>
<li><a class="anchor" name="line239"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line240"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #007700">[</span><span style="color: #DD0000">'path'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line241"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #007700">[</span><span style="color: #DD0000">'host'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line242"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #007700">[</span><span style="color: #DD0000">'methods'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line243"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #007700">[</span><span style="color: #DD0000">'ips'</span><span style="color: #007700">]</span></span></code></li>
<li><a class="anchor" name="line244"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></span></code></li>
<li><a class="anchor" name="line245"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line246"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$attributes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #007700">[</span><span style="color: #DD0000">'roles'</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line247"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$access</span><span style="color: #007700">[</span><span style="color: #DD0000">'allow_if'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line248"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$attributes</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createExpression</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #007700">[</span><span style="color: #DD0000">'allow_if'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line249"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line250"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line251"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access_map'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line252"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addMethodCall</span><span style="color: #007700">(</span><span style="color: #DD0000">'add'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$matcher</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attributes</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$access</span><span style="color: #007700">[</span><span style="color: #DD0000">'requires_channel'</span><span style="color: #007700">]));</span></span></code></li>
<li><a class="anchor" name="line253"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line254"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line255"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line256"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createFirewalls</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line257"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line258"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'firewalls'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line259"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line260"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line261"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line262"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$firewalls&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'firewalls'</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line263"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$providerIds&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createUserProviders</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line264"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line265"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;make&nbsp;the&nbsp;ContextListener&nbsp;aware&nbsp;of&nbsp;the&nbsp;configured&nbsp;user&nbsp;providers</span></span></code></li>
<li><a class="anchor" name="line266"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$contextListenerDefinition&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.context_listener'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line267"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$arguments&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$contextListenerDefinition</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getArguments</span><span style="color: #007700">();</span></span></code></li>
<li><a class="anchor" name="line268"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userProviders&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line269"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$providerIds&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$userProviderId</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line270"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userProviders</span><span style="color: #007700">[]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$userProviderId</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line271"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line272"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$arguments</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">IteratorArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$userProviders</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line273"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$contextListenerDefinition</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setArguments</span><span style="color: #007700">(</span><span style="color: #0000BB">$arguments</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line274"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line275"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$customUserChecker&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line276"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line277"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;load&nbsp;firewall&nbsp;map</span></span></code></li>
<li><a class="anchor" name="line278"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mapDef&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.firewall.map'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line279"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$map&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$authenticationProviders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$contextRefs&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line280"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$firewalls&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line281"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'user_checker'</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;</span><span style="color: #DD0000">'security.user_checker'&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'user_checker'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line282"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$customUserChecker&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line283"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line284"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line285"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$configId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.firewall.map.config.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$name</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line286"></a><code><span style="color: #007700"></span></span></code></li>
<li class="selected"><a class="anchor" name="line287"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span style="color: #0000BB">$matcher</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$exceptionListener</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$logoutListener</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createFirewall</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$authenticationProviders</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$configId</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line288"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line289"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$contextId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.firewall.map.context.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$name</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line290"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$context&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$contextId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.firewall.context'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line291"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$context</span></span></code></li>
<li><a class="anchor" name="line292"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">IteratorArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">))</span></span></code></li>
<li><a class="anchor" name="line293"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$exceptionListener</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line294"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$logoutListener</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line295"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$configId</span><span style="color: #007700">))</span></span></code></li>
<li><a class="anchor" name="line296"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line297"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line298"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$contextRefs</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextId</span><span style="color: #007700">]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$contextId</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line299"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$map</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextId</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$matcher</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line300"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line301"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mapDef</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ServiceLocatorTagPass</span><span style="color: #007700">::</span><span style="color: #0000BB">register</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$contextRefs</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line302"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mapDef</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">IteratorArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$map</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line303"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line304"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;authentication&nbsp;providers&nbsp;to&nbsp;authentication&nbsp;manager</span></span></code></li>
<li><a class="anchor" name="line305"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$authenticationProviders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_map</span><span style="color: #007700">(function&nbsp;(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line306"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line307"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;</span><span style="color: #0000BB">array_values</span><span style="color: #007700">(</span><span style="color: #0000BB">array_unique</span><span style="color: #007700">(</span><span style="color: #0000BB">$authenticationProviders</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line308"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line309"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.manager'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line310"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">IteratorArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$authenticationProviders</span><span style="color: #007700">))</span></span></code></li>
<li><a class="anchor" name="line311"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line312"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line313"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;register&nbsp;an&nbsp;autowire&nbsp;alias&nbsp;for&nbsp;the&nbsp;UserCheckerInterface&nbsp;if&nbsp;no&nbsp;custom&nbsp;user&nbsp;checker&nbsp;service&nbsp;is&nbsp;configured</span></span></code></li>
<li><a class="anchor" name="line314"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">$customUserChecker</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line315"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'Symfony\Component\Security\Core\User\UserCheckerInterface'</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">Alias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.user_checker'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line316"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line317"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line318"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line319"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createFirewall</span><span style="color: #007700">(</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">$authenticationProviders</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$configId</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line320"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line321"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$configId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.firewall.config'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line322"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line323"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'user_checker'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line324"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line325"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Matcher</span></span></code></li>
<li><a class="anchor" name="line326"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$matcher&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line327"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'request_matcher'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line328"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$matcher&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'request_matcher'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line329"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'pattern'</span><span style="color: #007700">])&nbsp;||&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'host'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line330"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$pattern&nbsp;</span><span style="color: #007700">=&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'pattern'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'pattern'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line331"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'host'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'host'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line332"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$methods&nbsp;</span><span style="color: #007700">=&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'methods'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'methods'</span><span style="color: #007700">]&nbsp;:&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line333"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$matcher&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createRequestMatcher</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$pattern</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$host</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$methods</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line334"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line335"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line336"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$matcher&nbsp;</span><span style="color: #007700">?&nbsp;(string)&nbsp;</span><span style="color: #0000BB">$matcher&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line337"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'security'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line338"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line339"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Security&nbsp;disabled?</span></span></code></li>
<li><a class="anchor" name="line340"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'security'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line341"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #0000BB">$matcher</span><span style="color: #007700">,&nbsp;array(),&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line342"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line343"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line344"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'stateless'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line345"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line346"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Provider&nbsp;id&nbsp;(take&nbsp;the&nbsp;first&nbsp;registered&nbsp;provider&nbsp;if&nbsp;none&nbsp;defined)</span></span></code></li>
<li><a class="anchor" name="line347"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$defaultProvider&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line348"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line349"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isset(</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">[</span><span style="color: #0000BB">$normalizedName&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'-'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'_'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">])]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line350"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">InvalidConfigurationException</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Invalid&nbsp;firewall&nbsp;"%s":&nbsp;user&nbsp;provider&nbsp;"%s"&nbsp;not&nbsp;found.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">]));</span></span></code></li>
<li><a class="anchor" name="line351"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line352"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$defaultProvider&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">[</span><span style="color: #0000BB">$normalizedName</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line353"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">===&nbsp;\</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line354"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$defaultProvider&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">reset</span><span style="color: #007700">(</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line355"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line356"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line357"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultProvider</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line358"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line359"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Register&nbsp;listeners</span></span></code></li>
<li><a class="anchor" name="line360"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line361"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listenerKeys&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line362"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line363"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Channel&nbsp;listener</span></span></code></li>
<li><a class="anchor" name="line364"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">[]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.channel_listener'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line365"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line366"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$contextKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line367"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Context&nbsp;serializer&nbsp;listener</span></span></code></li>
<li><a class="anchor" name="line368"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'stateless'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line369"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$contextKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line370"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'context'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line371"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$contextKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'context'</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line372"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line373"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line374"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$logoutOnUserChange&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout_on_user_change'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line375"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Not&nbsp;setting&nbsp;"logout_on_user_change"&nbsp;to&nbsp;true&nbsp;on&nbsp;firewall&nbsp;"%s"&nbsp;is&nbsp;deprecated&nbsp;as&nbsp;of&nbsp;3.4,&nbsp;it&nbsp;will&nbsp;always&nbsp;be&nbsp;true&nbsp;in&nbsp;4.0.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">E_USER_DEPRECATED</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line376"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line377"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line378"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logoutOnUserChangeByContextKey</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">])&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logoutOnUserChangeByContextKey</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">][</span><span style="color: #0000BB">1</span><span style="color: #007700">]&nbsp;!==&nbsp;</span><span style="color: #0000BB">$logoutOnUserChange</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line379"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">InvalidConfigurationException</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Firewalls&nbsp;"%s"&nbsp;and&nbsp;"%s"&nbsp;need&nbsp;to&nbsp;have&nbsp;the&nbsp;same&nbsp;value&nbsp;for&nbsp;option&nbsp;"logout_on_user_change"&nbsp;as&nbsp;they&nbsp;are&nbsp;sharing&nbsp;the&nbsp;context&nbsp;"%s"'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logoutOnUserChangeByContextKey</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line380"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line381"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line382"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logoutOnUserChangeByContextKey</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">]&nbsp;=&nbsp;array(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$logoutOnUserChange</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line383"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">[]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createContextListener</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$logoutOnUserChange</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line384"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sessionStrategyId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.authentication.session_strategy'</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line385"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line386"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">statelessFirewallKeys</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line387"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sessionStrategyId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.authentication.session_strategy_noop'</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line388"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line389"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAlias</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">Alias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.session_strategy.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">$sessionStrategyId</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line390"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line391"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">6</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line392"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line393"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Logout&nbsp;listener</span></span></code></li>
<li><a class="anchor" name="line394"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListenerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line395"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line396"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListenerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.logout_listener.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line397"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListener&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$logoutListenerId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.logout_listener'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line398"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;array(</span></span></code></li>
<li><a class="anchor" name="line399"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'csrf_parameter'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'csrf_parameter'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line400"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'csrf_token_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'csrf_token_id'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line401"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'logout_path'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'path'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line402"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));</span></span></code></li>
<li><a class="anchor" name="line403"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line404"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;logout&nbsp;success&nbsp;handler</span></span></code></li>
<li><a class="anchor" name="line405"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'success_handler'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line406"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutSuccessHandlerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'success_handler'</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line407"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line408"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutSuccessHandlerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.logout.success_handler.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line409"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutSuccessHandler&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$logoutSuccessHandlerId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.logout.success_handler'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line410"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutSuccessHandler</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'target'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line411"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line412"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$logoutSuccessHandlerId</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line413"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line414"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;CSRF&nbsp;provider</span></span></code></li>
<li><a class="anchor" name="line415"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'csrf_token_generator'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line416"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'csrf_token_generator'</span><span style="color: #007700">]));</span></span></code></li>
<li><a class="anchor" name="line417"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line418"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line419"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;session&nbsp;logout&nbsp;handler</span></span></code></li>
<li><a class="anchor" name="line420"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">true&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'invalidate_session'</span><span style="color: #007700">]&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'stateless'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line421"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addMethodCall</span><span style="color: #007700">(</span><span style="color: #DD0000">'addHandler'</span><span style="color: #007700">,&nbsp;array(new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.logout.handler.session'</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line422"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line423"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line424"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;cookie&nbsp;logout&nbsp;handler</span></span></code></li>
<li><a class="anchor" name="line425"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(\</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'delete_cookies'</span><span style="color: #007700">])&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line426"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cookieHandlerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.logout.handler.cookie_clearing.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line427"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cookieHandler&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$cookieHandlerId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.logout.handler.cookie_clearing'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line428"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cookieHandler</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'delete_cookies'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line429"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line430"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addMethodCall</span><span style="color: #007700">(</span><span style="color: #DD0000">'addHandler'</span><span style="color: #007700">,&nbsp;array(new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$cookieHandlerId</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line431"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line432"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line433"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;add&nbsp;custom&nbsp;handlers</span></span></code></li>
<li><a class="anchor" name="line434"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'handlers'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$handlerId</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line435"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$logoutListener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addMethodCall</span><span style="color: #007700">(</span><span style="color: #DD0000">'addHandler'</span><span style="color: #007700">,&nbsp;array(new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$handlerId</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line436"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line437"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line438"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;register&nbsp;with&nbsp;LogoutUrlGenerator</span></span></code></li>
<li><a class="anchor" name="line439"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line440"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.logout_url_generator'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line441"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addMethodCall</span><span style="color: #007700">(</span><span style="color: #DD0000">'registerListener'</span><span style="color: #007700">,&nbsp;array(</span></span></code></li>
<li><a class="anchor" name="line442"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line443"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'path'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line444"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'csrf_token_id'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line445"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'csrf_parameter'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line446"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'csrf_token_generator'</span><span style="color: #007700">])&nbsp;?&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'logout'</span><span style="color: #007700">][</span><span style="color: #DD0000">'csrf_token_generator'</span><span style="color: #007700">])&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line447"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'stateless'</span><span style="color: #007700">]&nbsp;&amp;&amp;&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'context'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'context'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line448"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))</span></span></code></li>
<li><a class="anchor" name="line449"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line450"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line451"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line452"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Determine&nbsp;default&nbsp;entry&nbsp;point</span></span></code></li>
<li><a class="anchor" name="line453"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$configuredEntryPoint&nbsp;</span><span style="color: #007700">=&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'entry_point'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'entry_point'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line454"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line455"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Authentication&nbsp;listeners</span></span></code></li>
<li><a class="anchor" name="line456"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">list(</span><span style="color: #0000BB">$authListeners</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createAuthenticationListeners</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$authenticationProviders</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultProvider</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$configuredEntryPoint</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line457"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line458"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">7</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$configuredEntryPoint&nbsp;</span><span style="color: #007700">?:&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line459"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line460"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$authListeners</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line461"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line462"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Switch&nbsp;user&nbsp;listener</span></span></code></li>
<li><a class="anchor" name="line463"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'switch_user'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line464"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listenerKeys</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #DD0000">'switch_user'</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line465"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">[]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createSwitchUserListener</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'switch_user'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$defaultProvider</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'stateless'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line466"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line467"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line468"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Access&nbsp;listener</span></span></code></li>
<li><a class="anchor" name="line469"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">[]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.access_listener'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line470"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line471"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Exception&nbsp;listener</span></span></code></li>
<li><a class="anchor" name="line472"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$exceptionListener&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createExceptionListener</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$configuredEntryPoint&nbsp;</span><span style="color: #007700">?:&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'stateless'</span><span style="color: #007700">]));</span></span></code></li>
<li><a class="anchor" name="line473"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line474"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">8</span><span style="color: #007700">,&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_handler'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_handler'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line475"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">9</span><span style="color: #007700">,&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_url'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_url'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line476"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line477"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAlias</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.user_checker.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">Alias</span><span style="color: #007700">(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'user_checker'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line478"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line479"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">factories&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$position</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line480"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$position&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line481"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'-'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'_'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getKey</span><span style="color: #007700">());</span></span></code></li>
<li><a class="anchor" name="line482"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line483"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listenerKeys</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line484"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line485"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line486"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line487"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line488"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'anonymous'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line489"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listenerKeys</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #DD0000">'anonymous'</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line490"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line491"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line492"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$listenerKeys</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line493"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">11</span><span style="color: #007700">,&nbsp;isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'switch_user'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'switch_user'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line494"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line495"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #0000BB">$matcher</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$exceptionListener</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$logoutListenerId&nbsp;</span><span style="color: #007700">?&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$logoutListenerId</span><span style="color: #007700">)&nbsp;:&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line496"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line497"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line498"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createContextListener</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$logoutUserOnChange</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line499"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line500"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">contextListeners</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line501"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">contextListeners</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line502"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line503"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line504"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listenerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.context_listener.'</span><span style="color: #007700">.\</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">contextListeners</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line505"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$listenerId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.context_listener'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line506"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line507"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addMethodCall</span><span style="color: #007700">(</span><span style="color: #DD0000">'setLogoutOnUserChange'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #0000BB">$logoutUserOnChange</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line508"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line509"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">contextListeners</span><span style="color: #007700">[</span><span style="color: #0000BB">$contextKey</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$listenerId</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line510"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line511"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line512"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createAuthenticationListeners</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">,&nbsp;&amp;</span><span style="color: #0000BB">$authenticationProviders</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultProvider&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;array&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line513"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line514"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line515"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$hasListeners&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line516"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line517"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">listenerPositions&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$position</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line518"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">factories</span><span style="color: #007700">[</span><span style="color: #0000BB">$position</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line519"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'-'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'_'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getKey</span><span style="color: #007700">());</span></span></code></li>
<li><a class="anchor" name="line520"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line521"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line522"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line523"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isset(</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">[</span><span style="color: #0000BB">$normalizedName&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'-'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'_'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">])]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line524"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">InvalidConfigurationException</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Invalid&nbsp;firewall&nbsp;"%s":&nbsp;user&nbsp;provider&nbsp;"%s"&nbsp;not&nbsp;found.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">]));</span></span></code></li>
<li><a class="anchor" name="line525"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line526"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userProvider&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">[</span><span style="color: #0000BB">$normalizedName</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line527"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(</span><span style="color: #DD0000">'remember_me'&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line528"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;RememberMeFactory&nbsp;will&nbsp;use&nbsp;the&nbsp;firewall&nbsp;secret&nbsp;when&nbsp;created</span></span></code></li>
<li><a class="anchor" name="line529"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userProvider&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line530"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line531"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userProvider&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$defaultProvider&nbsp;</span><span style="color: #007700">?:&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getFirstProvider</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line532"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line533"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line534"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span style="color: #0000BB">$provider</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$listenerId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">create</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$userProvider</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line535"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line536"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">[]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$listenerId</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line537"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$authenticationProviders</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$provider</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line538"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$hasListeners&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line539"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line540"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line541"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line542"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line543"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Anonymous</span></span></code></li>
<li><a class="anchor" name="line544"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'anonymous'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line545"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'anonymous'</span><span style="color: #007700">][</span><span style="color: #DD0000">'secret'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line546"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'anonymous'</span><span style="color: #007700">][</span><span style="color: #DD0000">'secret'</span><span style="color: #007700">]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Parameter</span><span style="color: #007700">(</span><span style="color: #DD0000">'container.build_hash'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line547"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line548"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line549"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listenerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.authentication.listener.anonymous.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line550"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line551"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$listenerId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.listener.anonymous'</span><span style="color: #007700">))</span></span></code></li>
<li><a class="anchor" name="line552"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'anonymous'</span><span style="color: #007700">][</span><span style="color: #DD0000">'secret'</span><span style="color: #007700">])</span></span></code></li>
<li><a class="anchor" name="line553"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line554"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line555"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">[]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$listenerId</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line556"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line557"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$providerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.authentication.provider.anonymous.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line558"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line559"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$providerId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.provider.anonymous'</span><span style="color: #007700">))</span></span></code></li>
<li><a class="anchor" name="line560"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewall</span><span style="color: #007700">[</span><span style="color: #DD0000">'anonymous'</span><span style="color: #007700">][</span><span style="color: #DD0000">'secret'</span><span style="color: #007700">])</span></span></code></li>
<li><a class="anchor" name="line561"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line562"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line563"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$authenticationProviders</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$providerId</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line564"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$hasListeners&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line565"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line566"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line567"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$hasListeners</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line568"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">InvalidConfigurationException</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'No&nbsp;authentication&nbsp;listener&nbsp;registered&nbsp;for&nbsp;firewall&nbsp;"%s".'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line569"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line570"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line571"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #0000BB">$listeners</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line572"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line573"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line574"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createEncoders</span><span style="color: #007700">(</span><span style="color: #0000BB">$encoders</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line575"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line576"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$encoderMap&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line577"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$encoders&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$class&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$encoder</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line578"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$encoderMap</span><span style="color: #007700">[</span><span style="color: #0000BB">$class</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createEncoder</span><span style="color: #007700">(</span><span style="color: #0000BB">$encoder</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line579"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line580"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line581"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line582"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.encoder_factory.generic'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line583"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">setArguments</span><span style="color: #007700">(array(</span><span style="color: #0000BB">$encoderMap</span><span style="color: #007700">))</span></span></code></li>
<li><a class="anchor" name="line584"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line585"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line586"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line587"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createEncoder</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line588"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line589"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;a&nbsp;custom&nbsp;encoder&nbsp;service</span></span></code></li>
<li><a class="anchor" name="line590"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line591"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line592"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line593"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line594"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;plaintext&nbsp;encoder</span></span></code></li>
<li><a class="anchor" name="line595"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #DD0000">'plaintext'&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'algorithm'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line596"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$arguments&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'ignore_case'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line597"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line598"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span></span></code></li>
<li><a class="anchor" name="line599"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Encoder\PlaintextPasswordEncoder'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line600"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'arguments'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$arguments</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line601"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></span></code></li>
<li><a class="anchor" name="line602"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line603"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line604"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;pbkdf2&nbsp;encoder</span></span></code></li>
<li><a class="anchor" name="line605"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #DD0000">'pbkdf2'&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'algorithm'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line606"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span></span></code></li>
<li><a class="anchor" name="line607"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Encoder\Pbkdf2PasswordEncoder'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line608"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'arguments'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span></span></code></li>
<li><a class="anchor" name="line609"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'hash_algorithm'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line610"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'encode_as_base64'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line611"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'iterations'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line612"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'key_length'</span><span style="color: #007700">],</span></span></code></li>
<li><a class="anchor" name="line613"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),</span></span></code></li>
<li><a class="anchor" name="line614"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></span></code></li>
<li><a class="anchor" name="line615"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line616"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line617"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;bcrypt&nbsp;encoder</span></span></code></li>
<li><a class="anchor" name="line618"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #DD0000">'bcrypt'&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'algorithm'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line619"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span></span></code></li>
<li><a class="anchor" name="line620"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Encoder\BCryptPasswordEncoder'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line621"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'arguments'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'cost'</span><span style="color: #007700">]),</span></span></code></li>
<li><a class="anchor" name="line622"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></span></code></li>
<li><a class="anchor" name="line623"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line624"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line625"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Argon2i&nbsp;encoder</span></span></code></li>
<li><a class="anchor" name="line626"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #DD0000">'argon2i'&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'algorithm'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line627"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">Argon2iPasswordEncoder</span><span style="color: #007700">::</span><span style="color: #0000BB">isSupported</span><span style="color: #007700">())&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line628"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">InvalidConfigurationException</span><span style="color: #007700">(</span><span style="color: #DD0000">'Argon2i&nbsp;algorithm&nbsp;is&nbsp;not&nbsp;supported.&nbsp;Please&nbsp;install&nbsp;the&nbsp;libsodium&nbsp;extension&nbsp;or&nbsp;upgrade&nbsp;to&nbsp;PHP&nbsp;7.2+.'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line629"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line630"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line631"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span></span></code></li>
<li><a class="anchor" name="line632"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Symfony\Component\Security\Core\Encoder\Argon2iPasswordEncoder'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line633"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'arguments'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(),</span></span></code></li>
<li><a class="anchor" name="line634"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</span></span></code></li>
<li><a class="anchor" name="line635"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line636"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line637"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;run-time&nbsp;configured&nbsp;encoder</span></span></code></li>
<li><a class="anchor" name="line638"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line639"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line640"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line641"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Parses&nbsp;user&nbsp;providers&nbsp;and&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;their&nbsp;ids</span></span></code></li>
<li><a class="anchor" name="line642"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">createUserProviders</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line643"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line644"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$providerIds&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line645"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'providers'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$provider</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line646"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createUserDaoProvider</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$provider</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line647"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">[</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'-'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'_'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">)]&nbsp;=&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line648"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line649"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line650"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line651"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line652"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line653"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Parses&nbsp;a&nbsp;&lt;provider&gt;&nbsp;tag&nbsp;and&nbsp;returns&nbsp;the&nbsp;id&nbsp;for&nbsp;the&nbsp;related&nbsp;user&nbsp;provider&nbsp;service</span></span></code></li>
<li><a class="anchor" name="line654"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">createUserDaoProvider</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$provider</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line655"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line656"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getUserProviderId</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line657"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line658"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Doctrine&nbsp;Entity&nbsp;and&nbsp;In-memory&nbsp;DAO&nbsp;provider&nbsp;are&nbsp;managed&nbsp;by&nbsp;factories</span></span></code></li>
<li><a class="anchor" name="line659"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">userProviderFactories&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line660"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'-'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'_'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getKey</span><span style="color: #007700">());</span></span></code></li>
<li><a class="anchor" name="line661"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line662"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!empty(</span><span style="color: #0000BB">$provider</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line663"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">create</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$provider</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line664"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line665"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line666"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line667"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line668"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line669"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Existing&nbsp;DAO&nbsp;service&nbsp;provider</span></span></code></li>
<li><a class="anchor" name="line670"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$provider</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line671"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setAlias</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">Alias</span><span style="color: #007700">(</span><span style="color: #0000BB">$provider</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line672"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line673"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$provider</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line674"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line675"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line676"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Chain&nbsp;provider</span></span></code></li>
<li><a class="anchor" name="line677"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$provider</span><span style="color: #007700">[</span><span style="color: #DD0000">'chain'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line678"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$providers&nbsp;</span><span style="color: #007700">=&nbsp;array();</span></span></code></li>
<li><a class="anchor" name="line679"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$provider</span><span style="color: #007700">[</span><span style="color: #DD0000">'chain'</span><span style="color: #007700">][</span><span style="color: #DD0000">'providers'</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$providerName</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line680"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$providers</span><span style="color: #007700">[]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getUserProviderId</span><span style="color: #007700">(</span><span style="color: #0000BB">$providerName</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line681"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line682"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line683"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line684"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.user.provider.chain'</span><span style="color: #007700">))</span></span></code></li>
<li><a class="anchor" name="line685"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">IteratorArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$providers</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line686"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line687"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line688"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line689"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line690"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">InvalidConfigurationException</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Unable&nbsp;to&nbsp;create&nbsp;definition&nbsp;for&nbsp;"%s"&nbsp;user&nbsp;provider'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line691"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line692"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line693"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">getUserProviderId</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line694"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line695"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">'security.user.provider.concrete.'</span><span style="color: #007700">.</span><span style="color: #0000BB">strtolower</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line696"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line697"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line698"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createExceptionListener</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$stateless</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line699"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line700"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$exceptionListenerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.exception_listener.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line701"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$exceptionListenerId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.exception_listener'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line702"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line703"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">4</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$defaultEntryPoint&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">:&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$defaultEntryPoint</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line704"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">8</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$stateless</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line705"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line706"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;access&nbsp;denied&nbsp;handler&nbsp;setup</span></span></code></li>
<li><a class="anchor" name="line707"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_handler'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line708"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">6</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_handler'</span><span style="color: #007700">]));</span></span></code></li>
<li><a class="anchor" name="line709"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;elseif&nbsp;(isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_url'</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line710"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">5</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'access_denied_url'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line711"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line712"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line713"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$exceptionListenerId</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line714"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line715"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line716"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createSwitchUserListener</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$defaultProvider</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$stateless</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line717"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line718"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userProvider&nbsp;</span><span style="color: #007700">=&nbsp;isset(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getUserProviderId</span><span style="color: #007700">(</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'provider'</span><span style="color: #007700">])&nbsp;:&nbsp;(</span><span style="color: #0000BB">$defaultProvider&nbsp;</span><span style="color: #007700">?:&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getFirstProvider</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'switch_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line719"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line720"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;in&nbsp;4.0,&nbsp;ignore&nbsp;the&nbsp;`switch_user.stateless`&nbsp;key&nbsp;if&nbsp;$stateless&nbsp;is&nbsp;`true`</span></span></code></li>
<li><a class="anchor" name="line721"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$stateless&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">false&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'stateless'</span><span style="color: #007700">])&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line722"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Firewall&nbsp;"%s"&nbsp;is&nbsp;configured&nbsp;as&nbsp;"stateless"&nbsp;but&nbsp;the&nbsp;"switch_user.stateless"&nbsp;key&nbsp;is&nbsp;set&nbsp;to&nbsp;false.&nbsp;Both&nbsp;should&nbsp;have&nbsp;the&nbsp;same&nbsp;value,&nbsp;the&nbsp;firewall\'s&nbsp;"stateless"&nbsp;value&nbsp;will&nbsp;be&nbsp;used&nbsp;as&nbsp;default&nbsp;value&nbsp;for&nbsp;the&nbsp;"switch_user.stateless"&nbsp;key&nbsp;in&nbsp;4.0.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">E_USER_DEPRECATED</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line723"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line724"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line725"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$switchUserListenerId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.authentication.switchuser_listener.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line726"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$container</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDefinition</span><span style="color: #007700">(</span><span style="color: #0000BB">$switchUserListenerId</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">ChildDefinition</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.authentication.switchuser_listener'</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line727"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$userProvider</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line728"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #DD0000">'security.user_checker.'</span><span style="color: #007700">.</span><span style="color: #0000BB">$id</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line729"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">3</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line730"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">6</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'parameter'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line731"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">7</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'role'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line732"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$listener</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">replaceArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">9</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">[</span><span style="color: #DD0000">'stateless'</span><span style="color: #007700">]);</span></span></code></li>
<li><a class="anchor" name="line733"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line734"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$switchUserListenerId</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line735"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line736"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line737"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createExpression</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$expression</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line738"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line739"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">expressions</span><span style="color: #007700">[</span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.expression.'</span><span style="color: #007700">.</span><span style="color: #0000BB">ContainerBuilder</span><span style="color: #007700">::</span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #0000BB">$expression</span><span style="color: #007700">)]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line740"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">expressions</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line741"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line742"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line743"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line744"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">register</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Symfony\Component\ExpressionLanguage\SerializedParsedExpression'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line745"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">setPublic</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line746"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">$expression</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line747"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">addArgument</span><span style="color: #007700">(</span><span style="color: #0000BB">serialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getExpressionLanguage</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$expression</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'token'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'object'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'roles'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'request'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'trust_resolver'</span><span style="color: #007700">))-&gt;</span><span style="color: #0000BB">getNodes</span><span style="color: #007700">()))</span></span></code></li>
<li><a class="anchor" name="line748"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line749"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line750"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">expressions</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line751"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line752"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line753"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">createRequestMatcher</span><span style="color: #007700">(</span><span style="color: #0000BB">$container</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$path&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$host&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$methods&nbsp;</span><span style="color: #007700">=&nbsp;array(),&nbsp;</span><span style="color: #0000BB">$ip&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;array&nbsp;</span><span style="color: #0000BB">$attributes&nbsp;</span><span style="color: #007700">=&nbsp;array())</span></span></code></li>
<li><a class="anchor" name="line754"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line755"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$methods</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line756"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$methods&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_map</span><span style="color: #007700">(</span><span style="color: #DD0000">'strtoupper'</span><span style="color: #007700">,&nbsp;(array)&nbsp;</span><span style="color: #0000BB">$methods</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line757"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line758"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line759"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'security.request_matcher.'</span><span style="color: #007700">.</span><span style="color: #0000BB">ContainerBuilder</span><span style="color: #007700">::</span><span style="color: #0000BB">hash</span><span style="color: #007700">(array(</span><span style="color: #0000BB">$path</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$host</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$methods</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ip</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attributes</span><span style="color: #007700">));</span></span></code></li>
<li><a class="anchor" name="line760"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line761"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">requestMatchers</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">]))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line762"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">requestMatchers</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line763"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line764"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line765"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;only&nbsp;add&nbsp;arguments&nbsp;that&nbsp;are&nbsp;necessary</span></span></code></li>
<li><a class="anchor" name="line766"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$arguments&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #0000BB">$path</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$host</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$methods</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$ip</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attributes</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line767"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(\</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$arguments</span><span style="color: #007700">)&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">0&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;!</span><span style="color: #0000BB">end</span><span style="color: #007700">(</span><span style="color: #0000BB">$arguments</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line768"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_pop</span><span style="color: #007700">(</span><span style="color: #0000BB">$arguments</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line769"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line770"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line771"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$container</span></span></code></li>
<li><a class="anchor" name="line772"></a><code><span style="color: #0000BB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">register</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Symfony\Component\HttpFoundation\RequestMatcher'</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line773"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">setPublic</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line774"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">setArguments</span><span style="color: #007700">(</span><span style="color: #0000BB">$arguments</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line775"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</span></span></code></li>
<li><a class="anchor" name="line776"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line777"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">requestMatchers</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">]&nbsp;=&nbsp;new&nbsp;</span><span style="color: #0000BB">Reference</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line778"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line779"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line780"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">addSecurityListenerFactory</span><span style="color: #007700">(</span><span style="color: #0000BB">SecurityFactoryInterface&nbsp;$factory</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line781"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line782"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">factories</span><span style="color: #007700">[</span><span style="color: #0000BB">$factory</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getPosition</span><span style="color: #007700">()][]&nbsp;=&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line783"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line784"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line785"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">addUserProviderFactory</span><span style="color: #007700">(</span><span style="color: #0000BB">UserProviderFactoryInterface&nbsp;$factory</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line786"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line787"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">userProviderFactories</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$factory</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line788"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line789"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line790"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**</span></span></code></li>
<li><a class="anchor" name="line791"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Returns&nbsp;the&nbsp;base&nbsp;path&nbsp;for&nbsp;the&nbsp;XSD&nbsp;files.</span></span></code></li>
<li><a class="anchor" name="line792"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span></span></code></li>
<li><a class="anchor" name="line793"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;The&nbsp;XSD&nbsp;base&nbsp;path</span></span></code></li>
<li><a class="anchor" name="line794"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line795"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getXsdValidationBasePath</span><span style="color: #007700">()</span></span></code></li>
<li><a class="anchor" name="line796"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line797"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">__DIR__</span><span style="color: #007700">.</span><span style="color: #DD0000">'/../Resources/config/schema'</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line798"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line799"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line800"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getNamespace</span><span style="color: #007700">()</span></span></code></li>
<li><a class="anchor" name="line801"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line802"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">'http://symfony.com/schema/dic/security'</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line803"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line804"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line805"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getConfiguration</span><span style="color: #007700">(array&nbsp;</span><span style="color: #0000BB">$config</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ContainerBuilder&nbsp;$container</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line806"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line807"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;first&nbsp;assemble&nbsp;the&nbsp;factories</span></span></code></li>
<li><a class="anchor" name="line808"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;new&nbsp;</span><span style="color: #0000BB">MainConfiguration</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">factories</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">userProviderFactories</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line809"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line810"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line811"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">getExpressionLanguage</span><span style="color: #007700">()</span></span></code></li>
<li><a class="anchor" name="line812"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line813"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">expressionLanguage</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line814"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">class_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'Symfony\Component\ExpressionLanguage\ExpressionLanguage'</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line815"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span style="color: #0000BB">RuntimeException</span><span style="color: #007700">(</span><span style="color: #DD0000">'Unable&nbsp;to&nbsp;use&nbsp;expressions&nbsp;as&nbsp;the&nbsp;Symfony&nbsp;ExpressionLanguage&nbsp;component&nbsp;is&nbsp;not&nbsp;installed.'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line816"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line817"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">expressionLanguage&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">ExpressionLanguage</span><span style="color: #007700">();</span></span></code></li>
<li><a class="anchor" name="line818"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line819"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line820"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">expressionLanguage</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line821"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line822"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line823"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**</span></span></code></li>
<li><a class="anchor" name="line824"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@deprecated&nbsp;since&nbsp;version&nbsp;3.4,&nbsp;to&nbsp;be&nbsp;removed&nbsp;in&nbsp;4.0</span></span></code></li>
<li><a class="anchor" name="line825"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line826"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">getFirstProvider</span><span style="color: #007700">(</span><span style="color: #0000BB">$firewallName</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$listenerName</span><span style="color: #007700">,&nbsp;array&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line827"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line828"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Listener&nbsp;"%s"&nbsp;on&nbsp;firewall&nbsp;"%s"&nbsp;has&nbsp;no&nbsp;"provider"&nbsp;set&nbsp;but&nbsp;multiple&nbsp;providers&nbsp;exist.&nbsp;Using&nbsp;the&nbsp;first&nbsp;configured&nbsp;provider&nbsp;(%s)&nbsp;is&nbsp;deprecated&nbsp;since&nbsp;Symfony&nbsp;3.4&nbsp;and&nbsp;will&nbsp;throw&nbsp;an&nbsp;exception&nbsp;in&nbsp;4.0,&nbsp;set&nbsp;the&nbsp;"provider"&nbsp;key&nbsp;on&nbsp;the&nbsp;firewall&nbsp;instead.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$listenerName</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$firewallName</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$first&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_keys</span><span style="color: #007700">(</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">)[</span><span style="color: #0000BB">0</span><span style="color: #007700">]),&nbsp;</span><span style="color: #0000BB">E_USER_DEPRECATED</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line829"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line830"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$providerIds</span><span style="color: #007700">[</span><span style="color: #0000BB">$first</span><span style="color: #007700">];</span></span></code></li>
<li><a class="anchor" name="line831"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line832"></a><code><span style="color: #007700">}</span></span></code></li>
<li><a class="anchor" name="line833"></a><code><span style="color: #007700"></span>
</span></code></li></ol>
</div>
    </body>
</html>
