<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="robots" content="noindex,nofollow" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Symfony Profiler</title>
        <link rel="icon" type="image/x-icon" sizes="16x16" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAFEUlEQVR4AZVXA4wm2RMf27bXDM/+3/+sYBGfrbVtezc6BWtzfPbYXtvDL9906t6v0vWl05me7q1JzXuvvu4yXnvZgJ9hH6bwZYXLFR739vauUGuDwhq1L1N4Uv/tRYUhFjwcg49hn6aYr1V4TiGp86CoP9Oh1tV414KnM6t9fHymKUZ3DAI0hW4b1AyK3lE8phh5OxWeoJgUGhi5mLm95YzBwcHuhIQEV1JSEoWGhoKWHxYWFmenhJ/B5W0GwZpDt5Ovry9lZWWRyWOu5ORk7JsUpogsq5gnmISTU+HKQoLFQv/qq6/os88+I+EVFRUlSsRZ5oRiVmwlXMWShQkahUdERJCfnx/vd+3aRTU1NXTixAmqrq6mK1eu0PTp05mnrmD+QK6XhLO0XP2O2FJAQICRjjMU4P1PP/1EfX19NGfOHM8Z0N7ezueQkBBXYGAgSWIaQ5Em2T5QzFNSUig9PV3OHOe4uDjZ87p//34C7Nm7x/NcRUUFAX799Vec8Y7m7+8Pz92SfBDXr7VwPYRbxn/MmDG8Tps2jQBd3V30/PPPe35/6qmnaPXq1TR69Gg+h4eHiwwosdLT4dBkQDSXWmJiIq/vv/8+/fvvv3ThwgWqr6+n/Px8oyCmAerq6jy03Nxc2Yv7ySSjQzrmi4i92fVpaWlYOZ79/f2MW7dtpSlTptDp06epo6ODPvroI850ASiGdyZOnEjXrl2jyspKT4XA9cgjkaPL/D8UWG62HokieyQQoKSkRGiMs2bNotraWmprayOBNWvWyO+scGdnp5zF/WYvLEb8TwpRykp1MV7feust6uzqJMD169fpueeeY/rDDz/MKzzgdrsJoGkaffvtt/TFF19wQsIDmzZtssojt+6Fo1CgzKiAvAB3DRs2jAULtLS0eErPGB5Ad3c3lZaWUnFxMfeAd955h5+JjY3FaqXAPwhBnRCNySK4b98+Aoilv/z6i/zGggSk1g0opWupAMvGP91yt96zadWqVdTc3Ezz58/31LOAy+US6zgHBP766y+mDR8+HBUgFWSnQI2EAFnqlpcaGxsJIFkMN8L9AnPnzmX6jRs3SACeAi0vL888JwYPgTEJpauhnADo6/LSgQMHCHD37l2Cp15//XXq7eslgKb+Fi1exM9lZmbaCDclIcpQQhATE4OVsrOzuamg+cyePZuzG64Hrlu3jp9ZuWolCdy+fZueeOIJpkdHR1sLHqgM0Yh0bTRz1m7fvp2KiopYkYKCApo8ebLZIwzlFeXSOXEnsLPe2Ij+p5DbYYdOdOtDQ0rNjFya5sTcsGGDcTDZoXTcNoVBMoxWyzDS2yXmOyeUtGSskmDjx4/nRgPAfBDmMpZtUIbRcsi2GsfSD2QYyd2OcdmyZSSwdu1apuXk5GB16v4bak0yX0imyIUEgwNovFTglhMZGcm0srIy43zAVUxuTLbW4xn17Fci23wly9dngUummrTaixcvMpOtW7fiiBwQpqKYU9efHuxDJE5hC9wvL9TW1RLg+PHjPGTQ8wsLC4WpDC5Y5UR4k5qKMSLT6lqeAiX0nuAaMmSI9sMPP9CZM2foyJEj9O677wpTVIuTjidNp0HibvttoH9E5OMqbWKkSaNSlojldoLF7TEP+nUEmKI62y1kOBINbVaNarcI0PuGGUlHyfYvLHg7/jhFSFYqZh0P8KHSptd5ksOPU3tvqAEUot/hFmOIYJLp87wGe9Dwm95eg5xa/R8G6d8U5EcFhwAAAABJRU5ErkJggg==">

            <style>
        
html{font-family:sans-serif;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{margin:.67em 0;font-size:2em}mark{color:#000;background:#ff0}small{font-size:80%}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{height:0;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{padding:.35em .625em .75em;margin:0 2px;border:1px solid silver}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}

html, body  {
    height: 100%;
    width: 100%;
}
body {
    background-color: #F9F9F9;
    color: #aaa;
    display: flex;
    flex-direction: column;
    font-family: Helvetica, Arial, sans-serif;
    font-size: 14px;
    line-height: 1.4;
}
.header {
    background-color: #222;
    position: fixed;
    top: 0;
    display: flex;
    width: 100%;
}
.header h1 {
    color: #FFF;
    font-weight: normal;
    font-size: 21px;
    margin: 0;
    padding: 10px 10px 8px;
    word-break: break-all;
}

a.doc {
    color: #FFF;
    text-decoration: none;
    margin: auto;
    margin-right: 10px;
}

a.doc:hover {
    text-decoration: underline;
}

.source {
    margin-top: 41px;
}

.source li code {
    color: #555;
}

.source li.selected {
    background: rgba(255, 255, 153, 0.5);
}

.anchor {
    position: relative;
    display: inline-block;
    top: -7em;
    visibility: hidden;
}

    </style>
    </head>
    <body>
        <div class="header">
    <h1>vendor/symfony/symfony/src/Symfony/Component/Security/Guard/Firewall/GuardAuthenticationListener.php <small>line 84</small></h1>
    <a class="doc" href="https://symfony.com/doc/3.4.15/reference/configuration/framework.html#ide" rel="help">Open in your IDE?</a>
</div>
<div class="source">
    <ol start="1"><li><a class="anchor" name="line1"></a><code><span style="color: #0000BB">&lt;?php</span></span></code></li>
<li><a class="anchor" name="line2"></a><code><span style="color: #0000BB"></span></span></code></li>
<li><a class="anchor" name="line3"></a><code><span style="color: #0000BB"></span><span style="color: #FF8000">/*</span></span></code></li>
<li><a class="anchor" name="line4"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;This&nbsp;file&nbsp;is&nbsp;part&nbsp;of&nbsp;the&nbsp;Symfony&nbsp;package.</span></span></code></li>
<li><a class="anchor" name="line5"></a><code><span style="color: #FF8000">&nbsp;*</span></span></code></li>
<li><a class="anchor" name="line6"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;(c)&nbsp;Fabien&nbsp;Potencier&nbsp;&lt;fabien@symfony.com&gt;</span></span></code></li>
<li><a class="anchor" name="line7"></a><code><span style="color: #FF8000">&nbsp;*</span></span></code></li>
<li><a class="anchor" name="line8"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;For&nbsp;the&nbsp;full&nbsp;copyright&nbsp;and&nbsp;license&nbsp;information,&nbsp;please&nbsp;view&nbsp;the&nbsp;LICENSE</span></span></code></li>
<li><a class="anchor" name="line9"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;file&nbsp;that&nbsp;was&nbsp;distributed&nbsp;with&nbsp;this&nbsp;source&nbsp;code.</span></span></code></li>
<li><a class="anchor" name="line10"></a><code><span style="color: #FF8000">&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line11"></a><code><span style="color: #FF8000"></span></span></code></li>
<li><a class="anchor" name="line12"></a><code><span style="color: #FF8000"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Guard</span><span style="color: #007700">\</span><span style="color: #0000BB">Firewall</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line13"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line14"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Psr</span><span style="color: #007700">\</span><span style="color: #0000BB">Log</span><span style="color: #007700">\</span><span style="color: #0000BB">LoggerInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line15"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">HttpFoundation</span><span style="color: #007700">\</span><span style="color: #0000BB">Request</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line16"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">HttpFoundation</span><span style="color: #007700">\</span><span style="color: #0000BB">Response</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line17"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">HttpKernel</span><span style="color: #007700">\</span><span style="color: #0000BB">Event</span><span style="color: #007700">\</span><span style="color: #0000BB">GetResponseEvent</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line18"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Core</span><span style="color: #007700">\</span><span style="color: #0000BB">Authentication</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticationManagerInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line19"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Core</span><span style="color: #007700">\</span><span style="color: #0000BB">Authentication</span><span style="color: #007700">\</span><span style="color: #0000BB">Token</span><span style="color: #007700">\</span><span style="color: #0000BB">TokenInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line20"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Core</span><span style="color: #007700">\</span><span style="color: #0000BB">Exception</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticationException</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line21"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Guard</span><span style="color: #007700">\</span><span style="color: #0000BB">AbstractGuardAuthenticator</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line22"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Guard</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticatorInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line23"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Guard</span><span style="color: #007700">\</span><span style="color: #0000BB">GuardAuthenticatorHandler</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line24"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Guard</span><span style="color: #007700">\</span><span style="color: #0000BB">GuardAuthenticatorInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line25"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Guard</span><span style="color: #007700">\</span><span style="color: #0000BB">Token</span><span style="color: #007700">\</span><span style="color: #0000BB">PreAuthenticationGuardToken</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line26"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">Firewall</span><span style="color: #007700">\</span><span style="color: #0000BB">ListenerInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line27"></a><code><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">Symfony</span><span style="color: #007700">\</span><span style="color: #0000BB">Component</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">\</span><span style="color: #0000BB">Http</span><span style="color: #007700">\</span><span style="color: #0000BB">RememberMe</span><span style="color: #007700">\</span><span style="color: #0000BB">RememberMeServicesInterface</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line28"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line29"></a><code><span style="color: #007700"></span><span style="color: #FF8000">/**</span></span></code></li>
<li><a class="anchor" name="line30"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;Authentication&nbsp;listener&nbsp;for&nbsp;the&nbsp;"guard"&nbsp;system.</span></span></code></li>
<li><a class="anchor" name="line31"></a><code><span style="color: #FF8000">&nbsp;*</span></span></code></li>
<li><a class="anchor" name="line32"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;@author&nbsp;Ryan&nbsp;Weaver&nbsp;&lt;ryan@knpuniversity.com&gt;</span></span></code></li>
<li><a class="anchor" name="line33"></a><code><span style="color: #FF8000">&nbsp;*&nbsp;@author&nbsp;Amaury&nbsp;Leroux&nbsp;de&nbsp;Lens&nbsp;&lt;amaury@lerouxdelens.com&gt;</span></span></code></li>
<li><a class="anchor" name="line34"></a><code><span style="color: #FF8000">&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line35"></a><code><span style="color: #FF8000"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">GuardAuthenticationListener&nbsp;</span><span style="color: #007700">implements&nbsp;</span><span style="color: #0000BB">ListenerInterface</span></span></code></li>
<li><a class="anchor" name="line36"></a><code><span style="color: #0000BB"></span><span style="color: #007700">{</span></span></code></li>
<li><a class="anchor" name="line37"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$guardHandler</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line38"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$authenticationManager</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line39"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$providerKey</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line40"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$guardAuthenticators</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line41"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$logger</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line42"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$rememberMeServices</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line43"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line44"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**</span></span></code></li>
<li><a class="anchor" name="line45"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;GuardAuthenticatorHandler&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$guardHandler&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;Guard&nbsp;handler</span></span></code></li>
<li><a class="anchor" name="line46"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;AuthenticationManagerInterface&nbsp;&nbsp;&nbsp;&nbsp;$authenticationManager&nbsp;An&nbsp;AuthenticationManagerInterface&nbsp;instance</span></span></code></li>
<li><a class="anchor" name="line47"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$providerKey&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;provider&nbsp;(i.e.&nbsp;firewall)&nbsp;key</span></span></code></li>
<li><a class="anchor" name="line48"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;iterable|AuthenticatorInterface[]&nbsp;$guardAuthenticators&nbsp;&nbsp;&nbsp;The&nbsp;authenticators,&nbsp;with&nbsp;keys&nbsp;that&nbsp;match&nbsp;what's&nbsp;passed&nbsp;to&nbsp;GuardAuthenticationProvider</span></span></code></li>
<li><a class="anchor" name="line49"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;LoggerInterface&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$logger&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;LoggerInterface&nbsp;instance</span></span></code></li>
<li><a class="anchor" name="line50"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line51"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">GuardAuthenticatorHandler&nbsp;$guardHandler</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">AuthenticationManagerInterface&nbsp;$authenticationManager</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$providerKey</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$guardAuthenticators</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">LoggerInterface&nbsp;$logger&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line52"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line53"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(empty(</span><span style="color: #0000BB">$providerKey</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line54"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span style="color: #0000BB">InvalidArgumentException</span><span style="color: #007700">(</span><span style="color: #DD0000">'$providerKey&nbsp;must&nbsp;not&nbsp;be&nbsp;empty.'</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line55"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line56"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line57"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardHandler&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$guardHandler</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line58"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">authenticationManager&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$authenticationManager</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line59"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">providerKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$providerKey</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line60"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardAuthenticators&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$guardAuthenticators</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line61"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$logger</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line62"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line63"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line64"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**</span></span></code></li>
<li><a class="anchor" name="line65"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Iterates&nbsp;over&nbsp;each&nbsp;authenticator&nbsp;to&nbsp;see&nbsp;if&nbsp;each&nbsp;wants&nbsp;to&nbsp;authenticate&nbsp;the&nbsp;request.</span></span></code></li>
<li><a class="anchor" name="line66"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line67"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">handle</span><span style="color: #007700">(</span><span style="color: #0000BB">GetResponseEvent&nbsp;$event</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line68"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line69"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line70"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$context&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'firewall_key'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">providerKey</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line71"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line72"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardAuthenticators&nbsp;</span><span style="color: #007700">instanceof&nbsp;\</span><span style="color: #0000BB">Countable&nbsp;</span><span style="color: #007700">||&nbsp;\</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardAuthenticators</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line73"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$context</span><span style="color: #007700">[</span><span style="color: #DD0000">'authenticators'</span><span style="color: #007700">]&nbsp;=&nbsp;\</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardAuthenticators</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line74"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line75"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line76"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">debug</span><span style="color: #007700">(</span><span style="color: #DD0000">'Checking&nbsp;for&nbsp;guard&nbsp;authentication&nbsp;credentials.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$context</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line77"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line78"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line79"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardAuthenticators&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line80"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;get&nbsp;a&nbsp;key&nbsp;that's&nbsp;unique&nbsp;to&nbsp;*this*&nbsp;guard&nbsp;authenticator</span></span></code></li>
<li><a class="anchor" name="line81"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;this&nbsp;MUST&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;GuardAuthenticationProvider</span></span></code></li>
<li><a class="anchor" name="line82"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$uniqueGuardKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">providerKey</span><span style="color: #007700">.</span><span style="color: #DD0000">'_'</span><span style="color: #007700">.</span><span style="color: #0000BB">$key</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line83"></a><code><span style="color: #007700"></span></span></code></li>
<li class="selected"><a class="anchor" name="line84"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">executeGuardAuthenticator</span><span style="color: #007700">(</span><span style="color: #0000BB">$uniqueGuardKey</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$event</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line85"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line86"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$event</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasResponse</span><span style="color: #007700">())&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line87"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line88"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">debug</span><span style="color: #007700">(</span><span style="color: #DD0000">'The&nbsp;"{authenticator}"&nbsp;authenticator&nbsp;set&nbsp;the&nbsp;response.&nbsp;Any&nbsp;later&nbsp;authenticator&nbsp;will&nbsp;not&nbsp;be&nbsp;called'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line89"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line90"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line91"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</span></span></code></li>
<li><a class="anchor" name="line92"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line93"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line94"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line95"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line96"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">executeGuardAuthenticator</span><span style="color: #007700">(</span><span style="color: #0000BB">$uniqueGuardKey</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">GuardAuthenticatorInterface&nbsp;$guardAuthenticator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">GetResponseEvent&nbsp;$event</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line97"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line98"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$request&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$event</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getRequest</span><span style="color: #007700">();</span></span></code></li>
<li><a class="anchor" name="line99"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line100"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line101"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">debug</span><span style="color: #007700">(</span><span style="color: #DD0000">'Calling&nbsp;getCredentials()&nbsp;on&nbsp;guard&nbsp;configurator.'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'firewall_key'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">providerKey</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line102"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line103"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line104"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;abort&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;authenticator&nbsp;if&nbsp;it&nbsp;doesn't&nbsp;support&nbsp;the&nbsp;request</span></span></code></li>
<li><a class="anchor" name="line105"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$guardAuthenticator&nbsp;</span><span style="color: #007700">instanceof&nbsp;</span><span style="color: #0000BB">AuthenticatorInterface</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line106"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">supports</span><span style="color: #007700">(</span><span style="color: #0000BB">$request</span><span style="color: #007700">))&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line107"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line108"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line109"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;as&nbsp;there&nbsp;was&nbsp;a&nbsp;support&nbsp;for&nbsp;given&nbsp;request,</span></span></code></li>
<li><a class="anchor" name="line110"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;authenticator&nbsp;is&nbsp;expected&nbsp;to&nbsp;give&nbsp;not-null&nbsp;credentials.</span></span></code></li>
<li><a class="anchor" name="line111"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$credentialsCanBeNull&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line112"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line113"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;deprecated&nbsp;since&nbsp;version&nbsp;3.4,&nbsp;to&nbsp;be&nbsp;removed&nbsp;in&nbsp;4.0</span></span></code></li>
<li><a class="anchor" name="line114"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$credentialsCanBeNull&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line115"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line116"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line117"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;allow&nbsp;the&nbsp;authenticator&nbsp;to&nbsp;fetch&nbsp;authentication&nbsp;info&nbsp;from&nbsp;the&nbsp;request</span></span></code></li>
<li><a class="anchor" name="line118"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$credentials&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCredentials</span><span style="color: #007700">(</span><span style="color: #0000BB">$request</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line119"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line120"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$credentials</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line121"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;deprecated&nbsp;since&nbsp;version&nbsp;3.4,&nbsp;to&nbsp;be&nbsp;removed&nbsp;in&nbsp;4.0</span></span></code></li>
<li><a class="anchor" name="line122"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$credentialsCanBeNull</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line123"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line124"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line125"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line126"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$guardAuthenticator&nbsp;</span><span style="color: #007700">instanceof&nbsp;</span><span style="color: #0000BB">AbstractGuardAuthenticator</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line127"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'Returning&nbsp;null&nbsp;from&nbsp;"%1$s::getCredentials()"&nbsp;is&nbsp;deprecated&nbsp;since&nbsp;Symfony&nbsp;3.4&nbsp;and&nbsp;will&nbsp;throw&nbsp;an&nbsp;\UnexpectedValueException&nbsp;in&nbsp;4.0.&nbsp;Return&nbsp;false&nbsp;from&nbsp;"%1$s::supports()"&nbsp;instead.'</span><span style="color: #007700">,&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)),&nbsp;</span><span style="color: #0000BB">E_USER_DEPRECATED</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line128"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line129"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line130"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line131"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line132"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span style="color: #0000BB">UnexpectedValueException</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">'The&nbsp;return&nbsp;value&nbsp;of&nbsp;"%1$s::getCredentials()"&nbsp;must&nbsp;not&nbsp;be&nbsp;null.&nbsp;Return&nbsp;false&nbsp;from&nbsp;"%1$s::supports()"&nbsp;instead.'</span><span style="color: #007700">,&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line133"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line134"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line135"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;create&nbsp;a&nbsp;token&nbsp;with&nbsp;the&nbsp;unique&nbsp;key,&nbsp;so&nbsp;that&nbsp;the&nbsp;provider&nbsp;knows&nbsp;which&nbsp;authenticator&nbsp;to&nbsp;use</span></span></code></li>
<li><a class="anchor" name="line136"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$token&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">PreAuthenticationGuardToken</span><span style="color: #007700">(</span><span style="color: #0000BB">$credentials</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$uniqueGuardKey</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line137"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line138"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line139"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">debug</span><span style="color: #007700">(</span><span style="color: #DD0000">'Passing&nbsp;guard&nbsp;token&nbsp;information&nbsp;to&nbsp;the&nbsp;GuardAuthenticationProvider'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'firewall_key'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">providerKey</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line140"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line141"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;pass&nbsp;the&nbsp;token&nbsp;into&nbsp;the&nbsp;AuthenticationManager&nbsp;system</span></span></code></li>
<li><a class="anchor" name="line142"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;this&nbsp;indirectly&nbsp;calls&nbsp;GuardAuthenticationProvider::authenticate()</span></span></code></li>
<li><a class="anchor" name="line143"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$token&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">authenticationManager</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">authenticate</span><span style="color: #007700">(</span><span style="color: #0000BB">$token</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line144"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line145"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line146"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">info</span><span style="color: #007700">(</span><span style="color: #DD0000">'Guard&nbsp;authentication&nbsp;successful!'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'token'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$token</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line147"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line148"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line149"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;sets&nbsp;the&nbsp;token&nbsp;on&nbsp;the&nbsp;token&nbsp;storage,&nbsp;etc</span></span></code></li>
<li><a class="anchor" name="line150"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardHandler</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">authenticateWithToken</span><span style="color: #007700">(</span><span style="color: #0000BB">$token</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">providerKey</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line151"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">AuthenticationException&nbsp;$e</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line152"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;oh&nbsp;no!&nbsp;Authentication&nbsp;failed!</span></span></code></li>
<li><a class="anchor" name="line153"></a><code><span style="color: #FF8000"></span></span></code></li>
<li><a class="anchor" name="line154"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line155"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">info</span><span style="color: #007700">(</span><span style="color: #DD0000">'Guard&nbsp;authentication&nbsp;failed.'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'exception'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line156"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line157"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line158"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$response&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardHandler</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">handleAuthenticationFailure</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">providerKey</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line159"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line160"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$response&nbsp;</span><span style="color: #007700">instanceof&nbsp;</span><span style="color: #0000BB">Response</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line161"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$event</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setResponse</span><span style="color: #007700">(</span><span style="color: #0000BB">$response</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line162"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line163"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line164"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line165"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line166"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line167"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;success!</span></span></code></li>
<li><a class="anchor" name="line168"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$response&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">guardHandler</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">handleAuthenticationSuccess</span><span style="color: #007700">(</span><span style="color: #0000BB">$token</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">providerKey</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line169"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$response&nbsp;</span><span style="color: #007700">instanceof&nbsp;</span><span style="color: #0000BB">Response</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line170"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line171"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">debug</span><span style="color: #007700">(</span><span style="color: #DD0000">'Guard&nbsp;authenticator&nbsp;set&nbsp;success&nbsp;response.'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'response'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$response</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line172"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line173"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line174"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$event</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setResponse</span><span style="color: #007700">(</span><span style="color: #0000BB">$response</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line175"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line176"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line177"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">debug</span><span style="color: #007700">(</span><span style="color: #DD0000">'Guard&nbsp;authenticator&nbsp;set&nbsp;no&nbsp;success&nbsp;response:&nbsp;request&nbsp;continues.'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line178"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line179"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line180"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line181"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;attempt&nbsp;to&nbsp;trigger&nbsp;the&nbsp;remember&nbsp;me&nbsp;functionality</span></span></code></li>
<li><a class="anchor" name="line182"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">triggerRememberMe</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$request</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$token</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$response</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line183"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line184"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line185"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**</span></span></code></li>
<li><a class="anchor" name="line186"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Should&nbsp;be&nbsp;called&nbsp;if&nbsp;this&nbsp;listener&nbsp;will&nbsp;support&nbsp;remember&nbsp;me.</span></span></code></li>
<li><a class="anchor" name="line187"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line188"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">setRememberMeServices</span><span style="color: #007700">(</span><span style="color: #0000BB">RememberMeServicesInterface&nbsp;$rememberMeServices</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line189"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line190"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rememberMeServices&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$rememberMeServices</span><span style="color: #007700">;</span></span></code></li>
<li><a class="anchor" name="line191"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line192"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line193"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**</span></span></code></li>
<li><a class="anchor" name="line194"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Checks&nbsp;to&nbsp;see&nbsp;if&nbsp;remember&nbsp;me&nbsp;is&nbsp;supported&nbsp;in&nbsp;the&nbsp;authenticator&nbsp;and</span></span></code></li>
<li><a class="anchor" name="line195"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;on&nbsp;the&nbsp;firewall.&nbsp;If&nbsp;it&nbsp;is,&nbsp;the&nbsp;RememberMeServicesInterface&nbsp;is&nbsp;notified.</span></span></code></li>
<li><a class="anchor" name="line196"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></span></code></li>
<li><a class="anchor" name="line197"></a><code><span style="color: #FF8000">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">private&nbsp;function&nbsp;</span><span style="color: #0000BB">triggerRememberMe</span><span style="color: #007700">(</span><span style="color: #0000BB">GuardAuthenticatorInterface&nbsp;$guardAuthenticator</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Request&nbsp;$request</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">TokenInterface&nbsp;$token</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Response&nbsp;$response&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line198"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line199"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rememberMeServices</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line200"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line201"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">debug</span><span style="color: #007700">(</span><span style="color: #DD0000">'Remember&nbsp;me&nbsp;skipped:&nbsp;it&nbsp;is&nbsp;not&nbsp;configured&nbsp;for&nbsp;the&nbsp;firewall.'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line202"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line203"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line204"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line205"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line206"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line207"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">supportsRememberMe</span><span style="color: #007700">())&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line208"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">!==&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line209"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">debug</span><span style="color: #007700">(</span><span style="color: #DD0000">'Remember&nbsp;me&nbsp;skipped:&nbsp;your&nbsp;authenticator&nbsp;does&nbsp;not&nbsp;support&nbsp;it.'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)));</span></span></code></li>
<li><a class="anchor" name="line210"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line211"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line212"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</span></span></code></li>
<li><a class="anchor" name="line213"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line214"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line215"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$response&nbsp;</span><span style="color: #007700">instanceof&nbsp;</span><span style="color: #0000BB">Response</span><span style="color: #007700">)&nbsp;{</span></span></code></li>
<li><a class="anchor" name="line216"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;\</span><span style="color: #0000BB">LogicException</span><span style="color: #007700">(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span></span></code></li>
<li><a class="anchor" name="line217"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'%s::onAuthenticationSuccess&nbsp;*must*&nbsp;return&nbsp;a&nbsp;Response&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;the&nbsp;remember&nbsp;me&nbsp;functionality.&nbsp;Return&nbsp;a&nbsp;Response,&nbsp;or&nbsp;set&nbsp;remember_me&nbsp;to&nbsp;false&nbsp;under&nbsp;the&nbsp;guard&nbsp;configuration.'</span><span style="color: #007700">,</span></span></code></li>
<li><a class="anchor" name="line218"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</span><span style="color: #0000BB">get_class</span><span style="color: #007700">(</span><span style="color: #0000BB">$guardAuthenticator</span><span style="color: #007700">)</span></span></code></li>
<li><a class="anchor" name="line219"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));</span></span></code></li>
<li><a class="anchor" name="line220"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line221"></a><code><span style="color: #007700"></span></span></code></li>
<li><a class="anchor" name="line222"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rememberMeServices</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">loginSuccess</span><span style="color: #007700">(</span><span style="color: #0000BB">$request</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$response</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$token</span><span style="color: #007700">);</span></span></code></li>
<li><a class="anchor" name="line223"></a><code><span style="color: #007700">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code></li>
<li><a class="anchor" name="line224"></a><code><span style="color: #007700">}</span></span></code></li>
<li><a class="anchor" name="line225"></a><code><span style="color: #007700"></span>
</span></code></li></ol>
</div>
    </body>
</html>
